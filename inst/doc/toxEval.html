<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Steven R. Corsi, Laura A. De Cicco" />


<title>Introduction to toxEval</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Introduction to toxEval</h1>
<h4 class="author"><em>Steven R. Corsi, Laura A. De Cicco</em></h4>
<h4 class="date"><em>24 March, 2015</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#molecular-weights">Molecular weights</a></li>
<li><a href="#passive-data">Passive Data</a><ul>
<li><a href="#data-analysis">Data Analysis</a></li>
</ul></li>
<li><a href="#water-sample-data">Water Sample Data</a><ul>
<li><a href="#data-analysis-1">Data Analysis</a></li>
<li><a href="#relavent-censored-values">Relavent Censored Values</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This package <strong>toxEval</strong> is an early test version of the package that will encompass the various approaches to evaluate ToxCast data in relation to measured aquatic concentrations.</p>
<div id="molecular-weights" class="section level2">
<h2>Molecular weights</h2>
<p>ToxCast reports values in <span class="math">\(\log\)</span><span class="math">\(\mu\)</span>M. Data from water samples collected are typically mg/L, ng/L, or pg/L. Therefore, the first step is to determine the molecular weight of the measured data. The package <strong>webchem</strong> supports this functionality.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;webchem&quot;</span>)

molweight &lt;-<span class="st"> </span><span class="kw">cir_query</span>(<span class="st">'3380-34-5'</span>, <span class="st">&quot;mw&quot;</span>)</code></pre>
<pre><code>## http://cactus.nci.nih.gov/chemical/structure/3380-34-5/mw/xml</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">molweight</code></pre>
<pre><code>## [1] &quot;289.5451&quot;</code></pre>
<p>Data measured in aquatic environments can come in many different formats. This package will use example data measured from passive samplers, as well as water samples taken at a variety of sites around the Great Lakes.</p>
</div>
<div id="passive-data" class="section level2">
<h2>Passive Data</h2>
<p>Passive data was returned from the laboratory in a ‘long’ format. A sample of the data is shown below:</p>
<pre class="sourceCode r"><code class="sourceCode r">packagePath &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="dt">package=</span><span class="st">&quot;toxEval&quot;</span>)
filePath &lt;-<span class="st"> </span><span class="kw">file.path</span>(packagePath, <span class="st">&quot;passiveData.RData&quot;</span>)
<span class="kw">load</span>(<span class="dt">file=</span>filePath)

<span class="kw">head</span>(passiveData[,<span class="dv">1</span>:<span class="dv">7</span>])</code></pre>
<pre><code>##                    Chemical Units MLD  MQL site04101500 site04102500 site04108660
## 1               Trifluralin  pg/L 190  490         &lt;190         &lt;190         &lt;190
## 2   Hexachlorobenzene (HCB)  pg/L  32   88          130           49           33
## 3  Pentachloroanisole (PCA)  pg/L  69  210          150          160           93
## 4                Tefluthrin  pg/L 130  380         &lt;130         &lt;130         &lt;130
## 5 alpha-Benzenehexachloride  pg/L 190  570         &lt;190         &lt;190         &lt;190
## 6                   Lindane  pg/L 850 2400         &lt;850         &lt;850         &lt;850</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Unique units:</span>
<span class="kw">unique</span>(passiveData$Units)</code></pre>
<pre><code>## [1] &quot;pg/L&quot; &quot;ng/L&quot;</code></pre>
<p>For this data, the CAS column was used to retrieve the molecular weight (mlWt). Each column is a unique site where the data was collected. Each row is a unique measured chemical.</p>
<p>Some of the data is ‘left-censored’. This means that the measured data was lower than the detection limit of the measurement technique. Values that are found to be lower than the detection limit are indicated by a “&lt;”. The first thing to check is that the method quantitation limit (MQL) or minimum level of detectability (MLD) are low enough to be ignored. That is, MQL and MLD are below the minumum endpoint levels. If so, we can simply remove any values that have the “&lt;” indicator. To begin the study of the endpoints and how they relate to our data, we need to load up the <strong>toxEval</strong> package, and choose an endpoint dataset. We will use the AC50gain dataset in this report.</p>
<p>For this workflow, we will use the units reported by the measured data, meaning we need to convert the ToxCast end points to the units in the “Units” column of the passiveData data frame (we could also do the analysis converting the measured data to <span class="math">\(\log\)</span><span class="math">\(\mu\)</span>M… it shouldn’t matter as long as you are consistent).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(toxEval)

<span class="co"># AC50 data provided in the toxEval package:</span>
AC50gain &lt;-<span class="st"> </span>AC50gain

<span class="kw">head</span>(AC50gain[,<span class="dv">1</span>:<span class="dv">5</span>])</code></pre>
<pre><code>##        code  chid       casn                     chnm ACEA_T47D_80hr_Negative
## 1   C100005 20281   100-00-5  1-Chloro-4-nitrobenzene                      NA
## 2   C100016 20961   100-01-6           4-Nitroaniline                1.120699
## 3   C100027 21834   100-02-7            4-Nitrophenol                      NA
## 4 C10016203 30698 10016-20-3       alpha-Cyclodextrin                      NA
## 5   C100210 26080   100-21-0        Terephthalic acid                      NA
## 6 C10025748 41909 10025-74-8 Dysprosium(III) chloride                      NA</code></pre>
<p>The units in the AC50gain, AC50loss, and AC10 data sets are <span class="math">\(\log\)</span><span class="math">\(\mu\)</span>M. The first step is to convert to the desired unit (pg/L, ng/L) based on the passiveData data frame.</p>
<p><span class="math">\[
\require{cancel}
\begin{aligned}
Reported Data = \log \mu M \\
\mu M = 10^{\log \mu M} \\
MW = \frac{g}{mol} , M = \frac{mol}{L}  \\
\cancel{\mu M} \left[\frac{\cancel{M}}{10^6 \cancel{\mu M}}\right] \left[\frac{1}{\cancel{M}}  \frac{\cancel{mol}}{L}\right] \left[ \frac{MW \cancel{g}}{\cancel{mol}}\right] \left[\frac{10^9 ng}{\cancel{g}}\right] = MW * 10^3 \frac{ng}{L} 
\end{aligned}
\]</span></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

unitConversion &lt;-<span class="st"> </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="dv">10</span>^<span class="dv">6</span>, <span class="dv">10</span>^<span class="dv">3</span>), <span class="kw">c</span>(<span class="st">&quot;pg/L&quot;</span>, <span class="st">&quot;ng/L&quot;</span>) )

AC50 &lt;-<span class="st"> </span><span class="kw">left_join</span>(AC50gain, passiveData[,<span class="kw">c</span>(<span class="st">&quot;CAS&quot;</span>, <span class="st">&quot;Units&quot;</span>, <span class="st">&quot;mlWt&quot;</span>)],
                   <span class="dt">by=</span> <span class="kw">c</span>(<span class="st">&quot;casn&quot;</span> =<span class="st"> &quot;CAS&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(Units)) %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">desiredUnits =</span> Units) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conversion =</span> unitConversion[desiredUnits] *<span class="st"> </span>mlWt) %&gt;%
<span class="st">  </span><span class="kw">select</span>(casn, chnm, desiredUnits, mlWt, conversion)</code></pre>
<p>A sample of the AC50 data frame is shown here:</p>
<table>
<thead>
<tr class="header">
<th align="left">casn</th>
<th align="left">chnm</th>
<th align="left">desiredUnits</th>
<th align="right">mlWt</th>
<th align="right">conversion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">101-20-2</td>
<td align="left">Triclocarban</td>
<td align="left">ng/L</td>
<td align="right">315.59</td>
<td align="right">315585.9</td>
</tr>
<tr class="even">
<td align="left">1024-57-3</td>
<td align="left">Heptachlor epoxide</td>
<td align="left">pg/L</td>
<td align="right">389.32</td>
<td align="right">389319900.0</td>
</tr>
<tr class="odd">
<td align="left">1031-07-8</td>
<td align="left">Endosulfan sulfate</td>
<td align="left">pg/L</td>
<td align="right">422.92</td>
<td align="right">422922000.0</td>
</tr>
<tr class="even">
<td align="left">103-90-2</td>
<td align="left">Acetaminophen</td>
<td align="left">ng/L</td>
<td align="right">151.16</td>
<td align="right">151164.6</td>
</tr>
<tr class="odd">
<td align="left">106-46-7</td>
<td align="left">1,4-Dichlorobenzene</td>
<td align="left">pg/L</td>
<td align="right">147.00</td>
<td align="right">147003600.0</td>
</tr>
<tr class="even">
<td align="left">108-95-2</td>
<td align="left">Phenol</td>
<td align="left">pg/L</td>
<td align="right">94.11</td>
<td align="right">94112800.0</td>
</tr>
</tbody>
</table>
<p>Next we can create a data frame with the AC50 converted endpoints:</p>
<pre class="sourceCode r"><code class="sourceCode r">AC50Converted &lt;-<span class="st"> </span><span class="kw">left_join</span>(AC50, AC50gain)</code></pre>
<pre><code>## Joining by: c(&quot;casn&quot;, &quot;chnm&quot;)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">infoColumns &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;casn&quot;</span>, <span class="st">&quot;chnm&quot;</span>, <span class="st">&quot;desiredUnits&quot;</span>,<span class="st">&quot;mlWt&quot;</span>, <span class="st">&quot;conversion&quot;</span>, <span class="st">&quot;code&quot;</span>,<span class="st">&quot;chid&quot;</span>)

endPointData &lt;-<span class="st"> </span>AC50Converted[,!(<span class="kw">names</span>(AC50Converted) %in%<span class="st"> </span>infoColumns)]
endPointData &lt;-<span class="st"> </span><span class="dv">10</span>^endPointData
endPointData &lt;-<span class="st"> </span>endPointData *<span class="st"> </span>AC50Converted$conversion
endPoint &lt;-<span class="st"> </span><span class="kw">cbind</span>(AC50, <span class="kw">data.frame</span>(endPointData))
endPoint &lt;-<span class="st"> </span><span class="kw">rename</span>(endPoint, <span class="dt">Units=</span>desiredUnits)</code></pre>
<p>Now, let’s look at the extreme reported endpoint (not including NA’s):</p>
<pre class="sourceCode r"><code class="sourceCode r">maxEndPoints &lt;-<span class="st"> </span><span class="kw">apply</span>(endPointData, <span class="dv">1</span>, max, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) 
minEndPoints &lt;-<span class="st"> </span><span class="kw">apply</span>(endPointData, <span class="dv">1</span>, min, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)

maxMinSummary &lt;-<span class="st"> </span><span class="kw">cbind</span>(endPoint[,<span class="kw">c</span>(<span class="st">&quot;chnm&quot;</span>, <span class="st">&quot;casn&quot;</span>, <span class="st">&quot;Units&quot;</span>)], 
                       <span class="dt">maxEndPoint=</span>maxEndPoints, 
                       <span class="dt">minEndPoint=</span>minEndPoints)</code></pre>
<p>Next, let’s determine if the MQL or MLD are going to tell us anything in relation to the ToxCast endpoints. Likewise, we can look at the maximum and minimum measured values.</p>
<pre class="sourceCode r"><code class="sourceCode r">siteColumns &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;site&quot;</span>,<span class="kw">names</span>(passiveData))
maxMinSummary &lt;-<span class="st"> </span><span class="kw">left_join</span>(maxMinSummary,passiveData[,-siteColumns], 
                           <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;casn&quot;</span>=<span class="st">&quot;CAS&quot;</span>, <span class="st">&quot;Units&quot;</span>=<span class="st">&quot;Units&quot;</span>))</code></pre>
<p>If any of the MLD are higher than the maxEndPoint, we wouldn’t be able to make any conclusions about the toxicity of the water:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(maxMinSummary$MLD &gt;<span class="st"> </span>maxMinSummary$minEndPoint)</code></pre>
<pre><code>## [1] 0</code></pre>
<p>So, 0 measurements have detection limitations that are greater than the minimum endpoint concentration. We might be interested to know how close the detection limit values come to the minimum endpoints.</p>
<p>The following chemicals have MLD’s within 0.01 of the miniumum endpoint value:</p>
<table>
<thead>
<tr class="header">
<th align="left">chnm</th>
<th align="right">minEndPoint</th>
<th align="right">MLD</th>
<th align="right">Maximum Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Naphthalene</td>
<td align="right">11723.73</td>
<td align="right">2100.00</td>
<td align="right">0.18</td>
</tr>
<tr class="even">
<td align="left">Fluorene</td>
<td align="right">1680.89</td>
<td align="right">100.00</td>
<td align="right">0.06</td>
</tr>
<tr class="odd">
<td align="left">Cotinine</td>
<td align="right">11.44</td>
<td align="right">0.47</td>
<td align="right">0.04</td>
</tr>
<tr class="even">
<td align="left">Aspirin</td>
<td align="right">13.55</td>
<td align="right">0.42</td>
<td align="right">0.03</td>
</tr>
<tr class="odd">
<td align="left">Heptachlor epoxide</td>
<td align="right">14653.94</td>
<td align="right">390.00</td>
<td align="right">0.03</td>
</tr>
<tr class="even">
<td align="left">Erythromycin</td>
<td align="right">6.96</td>
<td align="right">0.13</td>
<td align="right">0.02</td>
</tr>
<tr class="odd">
<td align="left">1,4-Dichlorobenzene</td>
<td align="right">80634.30</td>
<td align="right">920.00</td>
<td align="right">0.01</td>
</tr>
</tbody>
</table>
<p>Since it appears that we can ignore the censored values, the easist way to convert data to numbers then is to use the <code>as.numeric</code> function. This will convert the left-censored data to <code>NA</code>, generating a warning. To convert all the columns with the word ‘site’ in their column name to numeric, use the following commands:</p>
<pre class="sourceCode r"><code class="sourceCode r">siteColumns &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;site&quot;</span>,<span class="kw">names</span>(passiveData))
passiveData[,siteColumns] &lt;-<span class="st"> </span><span class="kw">sapply</span>(passiveData[,siteColumns], function(x) <span class="kw">as.numeric</span>(x))

<span class="co">#For this analysis, we'll consider NA's to be 0 (other options exist):</span>
passiveData[,siteColumns][<span class="kw">is.na</span>(passiveData[,siteColumns])] &lt;-<span class="st"> </span><span class="dv">0</span></code></pre>
<p>Now let’s check if the maximum measured values are greater than the minimum endpoint values:</p>
<table>
<thead>
<tr class="header">
<th align="left">Chemical</th>
<th align="right">minEndPoint</th>
<th align="right">maxMeasure</th>
<th align="right">EAR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Fluorene</td>
<td align="right">1680.89</td>
<td align="right">15000.00</td>
<td align="right">8.92</td>
</tr>
<tr class="even">
<td align="left">Cotinine</td>
<td align="right">11.44</td>
<td align="right">19.84</td>
<td align="right">1.73</td>
</tr>
<tr class="odd">
<td align="left">Erythromycin</td>
<td align="right">6.96</td>
<td align="right">11.73</td>
<td align="right">1.69</td>
</tr>
<tr class="even">
<td align="left">Aspirin</td>
<td align="right">13.55</td>
<td align="right">14.99</td>
<td align="right">1.11</td>
</tr>
<tr class="odd">
<td align="left">Caffeine</td>
<td align="right">174.77</td>
<td align="right">89.05</td>
<td align="right">0.51</td>
</tr>
<tr class="even">
<td align="left">Naphthalene</td>
<td align="right">11723.73</td>
<td align="right">5500.00</td>
<td align="right">0.47</td>
</tr>
<tr class="odd">
<td align="left">Gemfibrozil</td>
<td align="right">15.88</td>
<td align="right">4.68</td>
<td align="right">0.29</td>
</tr>
<tr class="even">
<td align="left">Hydrochlorothiazide (HCTZ)</td>
<td align="right">185.21</td>
<td align="right">23.05</td>
<td align="right">0.12</td>
</tr>
<tr class="odd">
<td align="left">Benzo[b]fluoranthene</td>
<td align="right">1009259.20</td>
<td align="right">69000.00</td>
<td align="right">0.07</td>
</tr>
<tr class="even">
<td align="left">Dichlorvos</td>
<td align="right">2194.20</td>
<td align="right">150.00</td>
<td align="right">0.07</td>
</tr>
<tr class="odd">
<td align="left">Heptachlor Epoxide</td>
<td align="right">14653.94</td>
<td align="right">820.00</td>
<td align="right">0.06</td>
</tr>
<tr class="even">
<td align="left">Acetaminophen</td>
<td align="right">1083.10</td>
<td align="right">53.98</td>
<td align="right">0.05</td>
</tr>
<tr class="odd">
<td align="left">Pyrene</td>
<td align="right">10926346.82</td>
<td align="right">360000.00</td>
<td align="right">0.03</td>
</tr>
<tr class="even">
<td align="left">Benz[a]anthracene</td>
<td align="right">2286992.89</td>
<td align="right">65000.00</td>
<td align="right">0.03</td>
</tr>
<tr class="odd">
<td align="left">Fluoranthene</td>
<td align="right">9752941.08</td>
<td align="right">240000.00</td>
<td align="right">0.02</td>
</tr>
<tr class="even">
<td align="left">Pentachloroanisole (PCA)</td>
<td align="right">252346.71</td>
<td align="right">5200.00</td>
<td align="right">0.02</td>
</tr>
<tr class="odd">
<td align="left">Phenanthrene</td>
<td align="right">4970654.40</td>
<td align="right">86000.00</td>
<td align="right">0.02</td>
</tr>
<tr class="even">
<td align="left">Biphenyl</td>
<td align="right">37036.01</td>
<td align="right">640.00</td>
<td align="right">0.02</td>
</tr>
<tr class="odd">
<td align="left">Dibenzo[a,h]anthracene</td>
<td align="right">252855.00</td>
<td align="right">3700.00</td>
<td align="right">0.01</td>
</tr>
<tr class="even">
<td align="left">1-methylnaphthalene</td>
<td align="right">1516348.51</td>
<td align="right">19000.00</td>
<td align="right">0.01</td>
</tr>
</tbody>
</table>
<div id="data-analysis" class="section level3">
<h3>Data Analysis</h3>
<p>Let’s start our analysis with one site (the first of the site columns: site04101500):</p>
<pre class="sourceCode r"><code class="sourceCode r">commonColumns &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Chemical&quot;</span>, <span class="st">&quot;Units&quot;</span>, 
                  <span class="st">&quot;MLD&quot;</span>, <span class="st">&quot;MQL&quot;</span>, <span class="st">&quot;CAS&quot;</span>, <span class="st">&quot;mlWt&quot;</span>)
oneSite &lt;-<span class="st"> </span>passiveData[,<span class="kw">c</span>(commonColumns, <span class="st">&quot;site04101500&quot;</span>)]
oneSite &lt;-<span class="st"> </span><span class="kw">rename</span>(oneSite, <span class="dt">value =</span> site04101500)
<span class="kw">head</span>(oneSite)</code></pre>
<pre><code>##                    Chemical Units MLD  MQL        CAS     mlWt value
## 1               Trifluralin  pg/L 190  490  1582-09-8 335.2823     0
## 2   Hexachlorobenzene (HCB)  pg/L  32   88   118-74-1 284.7840   130
## 3  Pentachloroanisole (PCA)  pg/L  69  210  1825-21-4 280.3651   150
## 4                Tefluthrin  pg/L 130  380 79538-32-2 418.7382     0
## 5 alpha-Benzenehexachloride  pg/L 190  570   319-85-6       NA     0
## 6                   Lindane  pg/L 850 2400    59-89-9       NA     0</code></pre>
<p>We can now look at the ratio of the measured data to the endpoints:</p>
<pre class="sourceCode r"><code class="sourceCode r">casnRow &lt;-<span class="st"> </span><span class="kw">setNames</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(oneSite),oneSite$CAS)
ratioPassive &lt;-<span class="st"> </span>oneSite[casnRow[endPoint$casn],<span class="st">&quot;value&quot;</span>] /<span class="st"> </span>endPointData
maxRatio &lt;-<span class="st"> </span><span class="kw">suppressWarnings</span>(<span class="kw">max</span>(<span class="kw">apply</span>(ratioPassive[,siteColumns], <span class="dv">1</span>, max, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) ))</code></pre>
<p>So for the passive dataset, the maximum ratio of the measured data to the endpoints for all chemicals at the first site is 0.0024879.</p>
<p>Extending this to all sites:</p>
<pre class="sourceCode r"><code class="sourceCode r">siteColumnsIndex &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;site&quot;</span>, <span class="kw">names</span>(passiveData))
maxRatioBySite &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">site=</span><span class="kw">names</span>(passiveData)[siteColumnsIndex],
                             <span class="dt">ratio_perc=</span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(siteColumnsIndex)),
                             <span class="dt">chemical =</span> <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="kw">length</span>(siteColumnsIndex)),
                             <span class="dt">endpoint =</span>  <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="kw">length</span>(siteColumnsIndex)),
                             <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)

for(i in <span class="kw">names</span>(passiveData)[siteColumnsIndex]){ <span class="co"># i = site columns</span>
  oneSite &lt;-<span class="st"> </span>passiveData[,<span class="kw">c</span>(commonColumns, i)]
  <span class="kw">names</span>(oneSite)[<span class="kw">names</span>(oneSite) ==<span class="st"> </span>i] &lt;-<span class="st"> 'value'</span>
  casnRow &lt;-<span class="st"> </span><span class="kw">setNames</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(oneSite),oneSite$CAS) <span class="co"># casnRow gets index of CAS in oneSite</span>
  ratioPassive &lt;-<span class="st"> </span>oneSite[casnRow[endPoint$casn],<span class="st">&quot;value&quot;</span>] /<span class="st"> </span>endPointData
  
  maxRatio &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">apply</span>(ratioPassive[,siteColumnsIndex], <span class="dv">1</span>, max, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) )*<span class="dv">100</span>
  maxRatioBySite[maxRatioBySite$site ==<span class="st"> </span>i,<span class="st">&quot;ratio_perc&quot;</span>] &lt;-<span class="st"> </span>maxRatio
  
  if(<span class="kw">is.finite</span>(maxRatio)){
    maxIndexChemical &lt;-<span class="st"> </span><span class="kw">which.max</span>(<span class="kw">apply</span>(ratioPassive[,siteColumnsIndex], <span class="dv">1</span>, max, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) )
    maxIndexEndpoint &lt;-<span class="st"> </span><span class="kw">apply</span>(ratioPassive[,siteColumnsIndex], <span class="dv">1</span>, which.max)[[maxIndexChemical]]
    maxRatioBySite[maxRatioBySite$site ==<span class="st"> </span>i,<span class="st">&quot;chemical&quot;</span>] &lt;-<span class="st"> </span>passiveData$Chemical[maxIndexChemical]
    maxRatioBySite[maxRatioBySite$site ==<span class="st"> </span>i,<span class="st">&quot;endpoint&quot;</span>] &lt;-<span class="st"> </span><span class="kw">names</span>(endPoint)[maxIndexEndpoint]
  }
}

maxRatioBySite &lt;-<span class="st"> </span><span class="kw">arrange</span>(maxRatioBySite, <span class="kw">desc</span>(ratio_perc)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(ratio_perc &gt;<span class="st"> </span><span class="fl">1E-4</span>) %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="st">&quot;Ratio [%]&quot;</span>=ratio_perc, 
         <span class="st">&quot;Chemical&quot;</span>=chemical, 
         <span class="st">&quot;End Point&quot;</span> =<span class="st"> </span>endpoint) 
<span class="kw">kable</span>(maxRatioBySite, <span class="dt">digits=</span><span class="dv">2</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="right">Ratio [%]</th>
<th align="left">Chemical</th>
<th align="left">End Point</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">site04092750</td>
<td align="right">6.84</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="even">
<td align="left">site04201500</td>
<td align="right">4.98</td>
<td align="left">Tefluthrin</td>
<td align="left">APR_HepG2_CellCycleArrest_72h_up</td>
</tr>
<tr class="odd">
<td align="left">site04166500</td>
<td align="right">1.98</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="even">
<td align="left">site04086000</td>
<td align="right">1.25</td>
<td align="left">Triethyl phosphate (TEP)</td>
<td align="left">APR_HepG2_CellCycleArrest_1h_up</td>
</tr>
<tr class="odd">
<td align="left">site040851385</td>
<td align="right">1.07</td>
<td align="left">Camphor</td>
<td align="left">APR_HepG2_MicrotubuleCSK_1h_up</td>
</tr>
<tr class="even">
<td align="left">site04085427</td>
<td align="right">0.88</td>
<td align="left">Tefluthrin</td>
<td align="left">APR_HepG2_CellCycleArrest_72h_up</td>
</tr>
<tr class="odd">
<td align="left">site04165500</td>
<td align="right">0.68</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="even">
<td align="left">site04174500</td>
<td align="right">0.62</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="odd">
<td align="left">site04095090</td>
<td align="right">0.51</td>
<td align="left">Camphor</td>
<td align="left">APR_HepG2_MicrotubuleCSK_1h_up</td>
</tr>
<tr class="even">
<td align="left">site04199000</td>
<td align="right">0.46</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="odd">
<td align="left">site04040000</td>
<td align="right">0.45</td>
<td align="left">Camphor</td>
<td align="left">APR_HepG2_MicrotubuleCSK_1h_up</td>
</tr>
<tr class="even">
<td align="left">site04208000</td>
<td align="right">0.37</td>
<td align="left">beta-Benzenehexachloride</td>
<td align="left">APR_HepG2_MicrotubuleCSK_72h_up</td>
</tr>
<tr class="odd">
<td align="left">site04132052</td>
<td align="right">0.34</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="even">
<td align="left">site04200500</td>
<td align="right">0.34</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="odd">
<td align="left">site04195500</td>
<td align="right">0.33</td>
<td align="left">beta-Benzenehexachloride</td>
<td align="left">APR_HepG2_MicrotubuleCSK_72h_up</td>
</tr>
<tr class="even">
<td align="left">site04212100</td>
<td align="right">0.29</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="odd">
<td align="left">site04102500</td>
<td align="right">0.28</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="even">
<td align="left">site04101500</td>
<td align="right">0.25</td>
<td align="left">beta-Benzenehexachloride</td>
<td align="left">APR_HepG2_MicrotubuleCSK_72h_up</td>
</tr>
<tr class="odd">
<td align="left">site04128500</td>
<td align="right">0.14</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="even">
<td align="left">site04249000</td>
<td align="right">0.08</td>
<td align="left">Phenol</td>
<td align="left">APR_HepG2_NuclearSize_1h_dn</td>
</tr>
<tr class="odd">
<td align="left">site04119400</td>
<td align="right">0.08</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="even">
<td align="left">site04067500</td>
<td align="right">0.07</td>
<td align="left">Triethyl phosphate (TEP)</td>
<td align="left">APR_HepG2_CellCycleArrest_1h_up</td>
</tr>
<tr class="odd">
<td align="left">site04029990</td>
<td align="right">0.06</td>
<td align="left">Triethyl phosphate (TEP)</td>
<td align="left">APR_HepG2_CellCycleArrest_1h_up</td>
</tr>
<tr class="even">
<td align="left">site04024000</td>
<td align="right">0.06</td>
<td align="left">Triethyl phosphate (TEP)</td>
<td align="left">APR_HepG2_CellCycleArrest_1h_up</td>
</tr>
<tr class="odd">
<td align="left">site04108660</td>
<td align="right">0.06</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="even">
<td align="left">site04135020</td>
<td align="right">0.06</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="odd">
<td align="left">site04157000</td>
<td align="right">0.05</td>
<td align="left">Triethyl phosphate (TEP)</td>
<td align="left">APR_HepG2_CellCycleArrest_1h_up</td>
</tr>
<tr class="even">
<td align="left">site04249000.1</td>
<td align="right">0.05</td>
<td align="left">beta-Benzenehexachloride</td>
<td align="left">APR_HepG2_MicrotubuleCSK_72h_up</td>
</tr>
<tr class="odd">
<td align="left">site04231600</td>
<td align="right">0.04</td>
<td align="left">Triethyl phosphate (TEP)</td>
<td align="left">APR_HepG2_CellCycleArrest_1h_up</td>
</tr>
<tr class="even">
<td align="left">site04176500</td>
<td align="right">0.04</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="odd">
<td align="left">site04121970</td>
<td align="right">0.04</td>
<td align="left">beta-Benzenehexachloride</td>
<td align="left">APR_HepG2_MicrotubuleCSK_72h_up</td>
</tr>
<tr class="even">
<td align="left">site04260500</td>
<td align="right">0.03</td>
<td align="left">cis-Permethrin</td>
<td align="left">APR_HepG2_MicrotubuleCSK_24h_dn</td>
</tr>
<tr class="odd">
<td align="left">site04213500</td>
<td align="right">0.03</td>
<td align="left">Triethyl phosphate (TEP)</td>
<td align="left">APR_HepG2_CellCycleArrest_1h_up</td>
</tr>
<tr class="even">
<td align="left">site04045500</td>
<td align="right">0.03</td>
<td align="left">Triethyl phosphate (TEP)</td>
<td align="left">APR_HepG2_CellCycleArrest_1h_up</td>
</tr>
<tr class="odd">
<td align="left">site04199500</td>
<td align="right">0.03</td>
<td align="left">Triethyl phosphate (TEP)</td>
<td align="left">APR_HepG2_CellCycleArrest_1h_up</td>
</tr>
<tr class="even">
<td align="left">site04193500</td>
<td align="right">0.03</td>
<td align="left">Mirex</td>
<td align="left">APR_HepG2_OxidativeStress_72h_dn</td>
</tr>
<tr class="odd">
<td align="left">site04269000</td>
<td align="right">0.01</td>
<td align="left">Menthol</td>
<td align="left">APR_HepG2_MitoMass_1h_up</td>
</tr>
<tr class="even">
<td align="left">site04056500</td>
<td align="right">0.00</td>
<td align="left">Fluorene</td>
<td align="left">APR_HepG2_OxidativeStress_72h_up</td>
</tr>
<tr class="odd">
<td align="left">site04122200</td>
<td align="right">0.00</td>
<td align="left">Chlorpyrifos</td>
<td align="left">APR_HepG2_OxidativeStress_24h_up</td>
</tr>
</tbody>
</table>
<p>So for the passive dataset, the maximum ratio of the measured data to the endpoints for all chemicals at all sites is 6.8366976, at site site04092750, from cis-Permethrin, based on endpoint APR_HepG2_MicrotubuleCSK_24h_dn.</p>
</div>
</div>
<div id="water-sample-data" class="section level2">
<h2>Water Sample Data</h2>
<p>The data returned from water sample tests was returned in a ‘wide’ format:</p>
<pre class="sourceCode r"><code class="sourceCode r">packagePath &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="dt">package=</span><span class="st">&quot;toxEval&quot;</span>)
filePath &lt;-<span class="st"> </span><span class="kw">file.path</span>(packagePath, <span class="st">&quot;waterSamples.RData&quot;</span>)
<span class="kw">load</span>(<span class="dt">file=</span>filePath)

<span class="kw">head</span>(waterSamples[,<span class="dv">1</span>:<span class="dv">10</span>])</code></pre>
<pre><code>##   ActivityStartDateGiven          site ActivityEndDateGiven qualifier_04254 valueToUse_04254
## 1    2010-09-13 11:15:00 USGS-04101500                 &lt;NA&gt;            &lt;NA&gt;               NA
## 2    2010-09-13 12:30:00 USGS-04032000                 &lt;NA&gt;            &lt;NA&gt;               NA
## 3    2010-09-13 13:15:00 USGS-04102500                 &lt;NA&gt;            &lt;NA&gt;               NA
## 4    2010-09-13 14:30:00 USGS-04040000                 &lt;NA&gt;            &lt;NA&gt;               NA
## 5    2010-09-13 16:30:00 USGS-04043000                 &lt;NA&gt;            &lt;NA&gt;               NA
## 6    2010-09-14 07:10:00 USGS-04119400  2010-10-12 08:35:00               &lt;              0.1
##   val_qual_tx_04254 meth_cd_04254 dqi_cd_04254 detectionLimit_04254 rpt_lev_cd_04254
## 1              &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;                   NA             &lt;NA&gt;
## 2              &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;                   NA             &lt;NA&gt;
## 3              &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;                   NA             &lt;NA&gt;
## 4              &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;                   NA             &lt;NA&gt;
## 5              &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;                   NA             &lt;NA&gt;
## 6                           GCM99            S                  0.2              IRL</code></pre>
<p>The first job is to once again find the unique units. This data is arranged by a 5 digit USGS parameter code. Using the <strong>dataRetrieval</strong> package, information about the parameter codes can be retrieved. Each parameter code has 6 columns: detectionLimit, rep_lev_cd, qualifier, valueToUse, val_qual_tex, meth_cd, dqi_cd. We can pull out one of those columns to find the unique paremeter codes, then use <strong>webchem</strong> to get the molecular weights.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dataRetrieval)

waterSamplePCodes &lt;-<span class="st"> </span><span class="kw">names</span>(waterSamples)[<span class="kw">grep</span>(<span class="st">&quot;valueToUse&quot;</span>, <span class="kw">names</span>(waterSamples))]
waterSamplePCodes &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(waterSamplePCodes, <span class="st">&quot;_&quot;</span>), function(x) x[<span class="dv">2</span>])

pCodeInfo &lt;-<span class="st"> </span><span class="kw">readNWISpCode</span>(waterSamplePCodes)

<span class="kw">unique</span>(pCodeInfo$parameter_units)

<span class="kw">library</span>(webchem)
pCodeInfo$mlWt &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">nrow</span>(pCodeInfo))
pCodeInfo$mlWt[pCodeInfo$casrn !=<span class="st"> &quot;&quot;</span>] &lt;-<span class="st"> </span><span class="kw">sapply</span>(pCodeInfo$casrn[pCodeInfo$casrn !=<span class="st"> &quot;&quot;</span>],
                function(x) <span class="kw">cir_query</span>(x, <span class="st">&quot;mw&quot;</span>, <span class="dt">first =</span> <span class="ot">TRUE</span>))
pCodeInfo$mlWt &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(pCodeInfo$mlWt)</code></pre>
<p>In this dataset, all the data is reported in ug/l. Our conversion therefore is:</p>
<p><span class="math">\[
\require{cancel}
\begin{aligned}
Reported Data = \log \mu M \\
\mu M = 10^{\log \mu M} \\
MW = \frac{g}{mol} , M = \frac{mol}{L}  \\
\cancel{\mu M} \left[\frac{\cancel{M}}{\cancel{10^6} \cancel{\mu M}}\right] \left[\frac{1}{\cancel{M}}  \frac{\cancel{mol}}{L}\right] \left[ \frac{MW \cancel{g}}{\cancel{mol}}\right] \left[\frac{\cancel{10^6} \mu g}{\cancel{g}}\right] = MW * \frac{\mu g}{L} 
\end{aligned}
\]</span></p>
<pre class="sourceCode r"><code class="sourceCode r">AC50 &lt;-<span class="st"> </span><span class="kw">left_join</span>(AC50gain, pCodeInfo[,<span class="kw">c</span>(<span class="st">&quot;casrn&quot;</span>, <span class="st">&quot;parameter_units&quot;</span>, <span class="st">&quot;mlWt&quot;</span>)],
                   <span class="dt">by=</span> <span class="kw">c</span>(<span class="st">&quot;casn&quot;</span>=<span class="st">&quot;casrn&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(parameter_units)) %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">desiredUnits =</span> parameter_units) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conversion =</span> mlWt) %&gt;%
<span class="st">  </span><span class="kw">select</span>(casn, chnm, desiredUnits, mlWt, conversion)</code></pre>
<p>Next we can create a data frame with the AC50 converted endpoints:</p>
<pre class="sourceCode r"><code class="sourceCode r">AC50Converted &lt;-<span class="st"> </span><span class="kw">left_join</span>(AC50, AC50gain)</code></pre>
<pre><code>## Joining by: c(&quot;casn&quot;, &quot;chnm&quot;)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">infoColumns &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;casn&quot;</span>, <span class="st">&quot;chnm&quot;</span>, <span class="st">&quot;desiredUnits&quot;</span>,<span class="st">&quot;mlWt&quot;</span>, <span class="st">&quot;conversion&quot;</span>, <span class="st">&quot;code&quot;</span>,<span class="st">&quot;chid&quot;</span>)

endPointData &lt;-<span class="st"> </span>AC50Converted[,!(<span class="kw">names</span>(AC50Converted) %in%<span class="st"> </span>infoColumns)]
endPointData &lt;-<span class="st"> </span><span class="dv">10</span>^endPointData
endPointData &lt;-<span class="st"> </span>endPointData *<span class="st"> </span>AC50Converted$conversion
endPoint &lt;-<span class="st"> </span><span class="kw">cbind</span>(AC50, <span class="kw">data.frame</span>(endPointData))
endPoint &lt;-<span class="st"> </span><span class="kw">rename</span>(endPoint, <span class="dt">Units=</span>desiredUnits)</code></pre>
<p>First, let’s look at the extreme reported endpoint (not including NA’s…that will actually may be important):</p>
<pre class="sourceCode r"><code class="sourceCode r">maxEndPoints &lt;-<span class="st"> </span><span class="kw">apply</span>(endPointData, <span class="dv">1</span>, max, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) 
minEndPoints &lt;-<span class="st"> </span><span class="kw">apply</span>(endPointData, <span class="dv">1</span>, min, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)

maxMinSummary &lt;-<span class="st"> </span><span class="kw">cbind</span>(endPoint[,<span class="kw">c</span>(<span class="st">&quot;chnm&quot;</span>, <span class="st">&quot;casn&quot;</span>, <span class="st">&quot;Units&quot;</span>)], 
                       <span class="dt">maxEndPoint=</span>maxEndPoints, 
                       <span class="dt">minEndPoint=</span>minEndPoints)</code></pre>
<p>The next task is to determine if the detectionLimit is going to tell us anything in relation to the ToxCast endpoints. Likewise, we can look at the maximum and minimum measured values.</p>
<pre class="sourceCode r"><code class="sourceCode r">pCodeSummary &lt;-<span class="st"> </span><span class="kw">select</span>(pCodeInfo, srsname, casrn, parameter_units, mlWt)

detectionLimits &lt;-<span class="st"> </span>waterSamples[,<span class="kw">grep</span>(<span class="st">&quot;detectionLimit&quot;</span>, <span class="kw">names</span>(waterSamples))]
detectionLimits &lt;-<span class="st"> </span><span class="kw">na.omit</span>(detectionLimits)

<span class="co"># Check if any change over time:</span>
<span class="kw">all</span>(<span class="kw">apply</span>(detectionLimits, <span class="dv">2</span>, function(x) <span class="kw">length</span>(<span class="kw">unique</span>(x))==<span class="dv">1</span>))</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#They do!</span></code></pre>
<p>For now, we’ll focus on the minimum detection level:</p>
<pre class="sourceCode r"><code class="sourceCode r">detLevels  &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">dl_pcode=</span><span class="kw">names</span>(detectionLimits),
                         <span class="dt">minDetLevel=</span><span class="kw">apply</span>(detectionLimits, <span class="dv">2</span>, min),
                         <span class="dt">row.names=</span><span class="ot">NULL</span>, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pCode=</span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(dl_pcode, <span class="st">&quot;_&quot;</span>), function(x) x[<span class="dv">2</span>])) %&gt;%
<span class="st">  </span><span class="kw">left_join</span>(pCodeInfo[<span class="kw">c</span>(<span class="st">&quot;parameter_cd&quot;</span>,<span class="st">&quot;casrn&quot;</span>)], <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;pCode&quot;</span>=<span class="st">&quot;parameter_cd&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">select</span>(casrn, pCode, minDetLevel) %&gt;%
<span class="st">  </span><span class="kw">right_join</span>(maxMinSummary, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;casrn&quot;</span>=<span class="st">&quot;casn&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">EAR=</span>minDetLevel/minEndPoint) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(EAR)) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(EAR &gt;<span class="st"> </span><span class="dv">1</span>)

<span class="kw">kable</span>(detLevels, <span class="dt">digits =</span> <span class="dv">3</span>)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">casrn</th>
<th align="left">pCode</th>
<th align="right">minDetLevel</th>
<th align="left">chnm</th>
<th align="left">Units</th>
<th align="right">maxEndPoint</th>
<th align="right">minEndPoint</th>
<th align="right">EAR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">62-73-7</td>
<td align="left">30218</td>
<td align="right">0.08</td>
<td align="left">Dichlorvos</td>
<td align="left">ug/l</td>
<td align="right">52195.50</td>
<td align="right">0.002</td>
<td align="right">36.460</td>
</tr>
<tr class="even">
<td align="left">51218-45-2</td>
<td align="left">82612</td>
<td align="right">0.04</td>
<td align="left">Metolachlor</td>
<td align="left">ug/l</td>
<td align="right">33343.61</td>
<td align="right">0.003</td>
<td align="right">13.882</td>
</tr>
<tr class="odd">
<td align="left">486-56-6</td>
<td align="left">61945</td>
<td align="right">0.08</td>
<td align="left">Cotinine</td>
<td align="left">ug/l</td>
<td align="right">25061.89</td>
<td align="right">0.011</td>
<td align="right">6.991</td>
</tr>
<tr class="even">
<td align="left">91-20-3</td>
<td align="left">34696</td>
<td align="right">0.02</td>
<td align="left">Naphthalene</td>
<td align="left">ug/l</td>
<td align="right">36478.73</td>
<td align="right">0.012</td>
<td align="right">1.706</td>
</tr>
<tr class="odd">
<td align="left">89-78-1</td>
<td align="left">62827</td>
<td align="right">0.20</td>
<td align="left">dl-Menthol</td>
<td align="left">ug/l</td>
<td align="right">11496.23</td>
<td align="right">0.145</td>
<td align="right">1.380</td>
</tr>
</tbody>
</table>
<p>This table shows us the chemicals that Dichlorvos, Metolachlor, Cotinine, Naphthalene, dl-Menthol may lead to issues since the detection levels are higher than some of the end point values.</p>
<p>In this case therefore, we cannot simply ignore all of the left-censored values. However, for the time being, we will use only non-censored values in our analysis. Let’s begin by trimming down the waterSamples data frame to only the relavent information. Here, we are setting all left-censored values to NA, we could instead use the detection limit.</p>
<pre class="sourceCode r"><code class="sourceCode r">qualColumns &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;qualifier&quot;</span>, <span class="kw">names</span>(waterSamples))
valColumns &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;valueToUse&quot;</span>, <span class="kw">names</span>(waterSamples))

waterData &lt;-<span class="st"> </span>waterSamples[,valColumns]
waterData[waterSamples[,qualColumns] ==<span class="st"> &quot;&lt;&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></code></pre>
<p>Now let’s check how many maximum measured values are greater than the minimum endpoint values:</p>
<table>
<thead>
<tr class="header">
<th align="left">casrn</th>
<th align="left">pCode</th>
<th align="right">maxValue</th>
<th align="left">chnm</th>
<th align="left">Units</th>
<th align="right">maxEndPoint</th>
<th align="right">minEndPoint</th>
<th align="right">EAR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">51218-45-2</td>
<td align="left">82612</td>
<td align="right">6.00</td>
<td align="left">Metolachlor</td>
<td align="left">ug/l</td>
<td align="right">33343.61</td>
<td align="right">0.003</td>
<td align="right">2082.327</td>
</tr>
<tr class="even">
<td align="left">62-73-7</td>
<td align="left">30218</td>
<td align="right">0.29</td>
<td align="left">Dichlorvos</td>
<td align="left">ug/l</td>
<td align="right">52195.50</td>
<td align="right">0.002</td>
<td align="right">132.167</td>
</tr>
<tr class="odd">
<td align="left">1912-24-9</td>
<td align="left">39630</td>
<td align="right">40.20</td>
<td align="left">Atrazine</td>
<td align="left">ug/l</td>
<td align="right">22305.55</td>
<td align="right">0.541</td>
<td align="right">74.350</td>
</tr>
<tr class="even">
<td align="left">134-62-3</td>
<td align="left">61947</td>
<td align="right">2.66</td>
<td align="left">DEET</td>
<td align="left">ug/l</td>
<td align="right">20867.84</td>
<td align="right">0.116</td>
<td align="right">22.974</td>
</tr>
<tr class="odd">
<td align="left">91-20-3</td>
<td align="left">34696</td>
<td align="right">0.14</td>
<td align="left">Naphthalene</td>
<td align="left">ug/l</td>
<td align="right">36478.73</td>
<td align="right">0.012</td>
<td align="right">11.942</td>
</tr>
<tr class="even">
<td align="left">486-56-6</td>
<td align="left">61945</td>
<td align="right">0.13</td>
<td align="left">Cotinine</td>
<td align="left">ug/l</td>
<td align="right">25061.89</td>
<td align="right">0.011</td>
<td align="right">11.360</td>
</tr>
<tr class="odd">
<td align="left">78-59-1</td>
<td align="left">34408</td>
<td align="right">0.88</td>
<td align="left">Isophorone</td>
<td align="left">ug/l</td>
<td align="right">28831.62</td>
<td align="right">0.125</td>
<td align="right">7.050</td>
</tr>
<tr class="even">
<td align="left">58-08-2</td>
<td align="left">81436</td>
<td align="right">0.63</td>
<td align="left">Caffeine</td>
<td align="left">ug/l</td>
<td align="right">63327.73</td>
<td align="right">0.175</td>
<td align="right">3.605</td>
</tr>
<tr class="odd">
<td align="left">87-86-5</td>
<td align="left">39032</td>
<td align="right">7.30</td>
<td align="left">Pentachlorophenol</td>
<td align="left">ug/l</td>
<td align="right">154921.05</td>
<td align="right">2.284</td>
<td align="right">3.196</td>
</tr>
<tr class="even">
<td align="left">89-78-1</td>
<td align="left">62827</td>
<td align="right">0.30</td>
<td align="left">dl-Menthol</td>
<td align="left">ug/l</td>
<td align="right">11496.23</td>
<td align="right">0.145</td>
<td align="right">2.070</td>
</tr>
<tr class="odd">
<td align="left">119-61-9</td>
<td align="left">62814</td>
<td align="right">0.28</td>
<td align="left">Benzophenone</td>
<td align="left">ug/l</td>
<td align="right">20771.15</td>
<td align="right">0.138</td>
<td align="right">2.033</td>
</tr>
<tr class="even">
<td align="left">106-46-7</td>
<td align="left">34571</td>
<td align="right">0.13</td>
<td align="left">1,4-Dichlorobenzene</td>
<td align="left">ug/l</td>
<td align="right">13253.85</td>
<td align="right">0.081</td>
<td align="right">1.612</td>
</tr>
<tr class="odd">
<td align="left">63-25-2</td>
<td align="left">39750</td>
<td align="right">0.46</td>
<td align="left">Carbaryl</td>
<td align="left">ug/l</td>
<td align="right">43814.73</td>
<td align="right">0.307</td>
<td align="right">1.501</td>
</tr>
<tr class="even">
<td align="left">84-66-2</td>
<td align="left">34336</td>
<td align="right">0.90</td>
<td align="left">Diethyl phthalate</td>
<td align="left">ug/l</td>
<td align="right">25348.82</td>
<td align="right">0.896</td>
<td align="right">1.004</td>
</tr>
</tbody>
</table>
<div id="data-analysis-1" class="section level3">
<h3>Data Analysis</h3>
</div>
<div id="relavent-censored-values" class="section level3">
<h3>Relavent Censored Values</h3>
<p>Remember that Dichlorvos, Metolachlor, Cotinine, Naphthalene, dl-Menthol have detection limits higher than at least one reported end point.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
