---
title: "Figure 3: Biological influence"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  rmarkdown::html_vignette
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Figure_3}
  \usepackage[utf8]{inputenc}
---


```{r setup, include=FALSE}
library(knitr)
library(rmarkdown)
options(continue=" ")
options(width=60)
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE,
                      fig.height = 7,
                      fig.width = 7)
```

## Biological influence

Boxplots of the maximum summation of exposure activity ratios for each site by individual intended target families computed using individual water samples collected from 57 Great Lakes Tributaries from 2010-2013. Boxplots include only those sites that had detections for chemicals that influence the intended target families in ToxCast assays. Chemicals that influence the intended target family transferase were not detected. None of the monitored chemicals influence endpoints from the intended target families phosphatase, esterase, hydrolase, lyase, methyltransferase, and miscellaneous protein (all not included in this figure). [Boxes, 25th to 75th percentiles; dark line, median; whiskers, 1.5 x the interquartile range (IQR); circles, values outside 1.5 x the IQR. n, number of sites with detections of chemicals that have activity for endpoints in designated intended target families.]



```{r }
library(readxl)
library(toxEval)
library(grid)

path_to_tox <-  system.file("extdata", package="toxEval")
file_name <- "OWC_data_fromSup.xlsx"

full_path <- file.path(path_to_tox, file_name)

chem_data <- read_excel(full_path, sheet = "Data")
chem_info <- read_excel(full_path, sheet = "Chemicals") 
chem_site <- read_excel(full_path, sheet = "Sites")
exclusion <- read_excel(full_path, sheet = "Exclude")

ACClong <- get_ACC(chem_info$CAS)
ACClong <- remove_flags(ACClong)

cleaned_ep <- clean_endPoint_info(endPointInfo)
filtered_ep <- filter_groups(cleaned_ep)

chemicalSummary <- get_chemical_summary(ACClong,
                                        filtered_ep,
                                        chem_data, 
                                        chem_site, 
                                        chem_info,
                                        exclusion)

#Trim some names:
chem_info$Class[chem_info$Class == "Antimicrobial Disinfectants"] <- "Antimicrobial"
chem_info$Class[chem_info$Class == "Detergent Metabolites"] <- "Detergent"
chem_info$Class[chem_info$Class == "Flavors and Fragrances"] <- "Flavor/Fragrance"

bioPlot <- plot_tox_boxplots(chemicalSummary, 
                               category = "Biological", 
                               manual_remove = c("Transferase","Undefined"))
bioPlot
grid.text("# Samples", 
         x = unit(.22, "npc"), 
         y = unit(.995, "npc"), gp=gpar(fontsize=7))
```

Could also do chemical classes:

```{r }
classPlot <- plot_tox_boxplots(chemicalSummary, 
                               category = "Chemical Class")
classPlot
grid.text("# Samples", 
         x = unit(.22, "npc"), 
         y = unit(.995, "npc"), gp=gpar(fontsize=7))
```

Could also or chemicals:

```{r }

chemPlot <- plot_tox_boxplots(chemicalSummary, 
                               category = "Chemical")
chemPlot
grid.text("# Samples", 
         x = unit(.35, "npc"), 
         y = unit(.995, "npc"), gp=gpar(fontsize=7))
```