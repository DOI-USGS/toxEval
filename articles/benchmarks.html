<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using Benchmarks • toxEval</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using Benchmarks">
<meta property="og:description" content="toxEval">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-53797708-7"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53797708-7');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">toxEval</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.1.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/Introduction.html">Background</a>
</li>
<li>
  <a href="../articles/basicWorkflow.html">Basic Workflow</a>
</li>
<li>
  <a href="../reference/index.html">Function Help</a>
</li>
<li>
  <a href="../articles/PrepareData.html">Data Preparation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shinyApp.html">Shiny App</a>
    </li>
    <li>
      <a href="../articles/benchmarks.html">Exploring Benchmarks</a>
    </li>
    <li>
      <a href="../articles/pivot.html">Prepare Data in R</a>
    </li>
    <li>
      <a href="../articles/does_curves.html">Dose Response Curves</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/bibliography.html">Bibliograpy</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USGS-R/toxEval">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using Benchmarks</h1>
            
            <h4 class="date">14 May, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/USGS-R/toxEval/blob/master/vignettes/benchmarks.Rmd"><code>vignettes/benchmarks.Rmd</code></a></small>
      <div class="hidden name"><code>benchmarks.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The majority of the examples in this documentation create EAR values from concentration “benchmarks” set by the ToxCast database. Here we describe a way to provide your own custom benchmarks data.</p>
</div>
<div id="dataRequirements" class="section level1">
<h1 class="hasAnchor">
<a href="#dataRequirements" class="anchor"></a>Preparing Benchmarks</h1>
<p>Input data for a custom toxEval input file should be prepared in a Microsoft ™ Excel file using specifically named sheets (also known as tabs). There are 4 mandatory sheets (Data, Chemical, Sites, Benchmarks). The sheets should appear as follows (although the order is not important):</p>
<p><img src="bench_tab.png" width="262"></p>
<div id="mandatory-information" class="section level2">
<h2 class="hasAnchor">
<a href="#mandatory-information" class="anchor"></a>Mandatory Information</h2>
<p>The mandatory columns are: CAS, Value, groupCol, Chemical. Additional column can be included, but will be ignored by <code>toxEval</code> functions.</p>
<ul>
<li><p>CAS: A character column defining the chemicals via their Chemical Abstracts Service (CAS) registry.</p></li>
<li><p>Chemical: A character column defining the name of the chemicals. This is necessary for labels because the only information <code>toxEval</code> uses by default for chemical names are the names assigned by the ToxCast database for an associated CAS.</p></li>
<li><p>endPoint: A character column naming the benchmark. This is analogous to the assay names in the ToxCast analysis.</p></li>
<li><p>Value: The concentration (in identical units as what is reported in the “Data” sheet) of the benchmark.</p></li>
<li><p>groupCol: A character column that groups endpoints. This is analogous to the Biological groupings from the ToxCast analysis.</p></li>
</ul>
</div>
</div>
<div id="explore-benchmarks" class="section level1">
<h1 class="hasAnchor">
<a href="#explore-benchmarks" class="anchor"></a>Explore Benchmarks</h1>
<p>In this section, we will assume there is a toxEval input file named “OWC_custom_bench.xlsx”, as descibed in <a href="#dataRequirements">Preparing Benchmarks</a>. The next section <a href="#setupExample">Create Example File</a> will walk through creating the “OWC_custom_bench.xlsx” file on the example data provided within the <code>toxEval</code> package.</p>
<div id="toxicity-quotient" class="section level2">
<h2 class="hasAnchor">
<a href="#toxicity-quotient" class="anchor"></a>Toxicity Quotient</h2>
<p>This example uses water quality guidelines/benchmarks from EPA and other sources. The guidelines are classified into chronic and acute categories.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">tox_list_bench</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_toxEval.html">create_toxEval</a></span>(<span class="st">"OWC_custom_bench.xlsx"</span>)</pre></body></html></div>
<p>Using a “Benchmark” tab in the input file, you can skip the <code>ACC</code> and <code>filtered_ep</code> arguments:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">summary_bench</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_chemical_summary.html">get_chemical_summary</a></span>(<span class="no">tox_list_bench</span>)</pre></body></html></div>
<p>For ToxCast EARs, it makes sense in the boxplot visualization to sum the EARs of all endpoints for a single chemical. This is due to the specific nature of the ToxCast endpoint suite of tests.</p>
<p>Some benchmarks such as these water quality guidelines already take into account the overall effects, and you do not want to sum those values. There is an argument in the <code>plot_tox_boxplots</code> function that allows you to specify: <code>sum_logic</code> (where TRUE sums the EARs for each chemical, and FALSE does not).</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_tox_boxplots.html">plot_tox_boxplots</a></span>(<span class="no">summary_bench</span>,
                  <span class="kw">category</span> <span class="kw">=</span> <span class="st">"Chemical"</span>,
                  <span class="kw">sum_logic</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                  <span class="kw">x_label</span> <span class="kw">=</span> <span class="st">"Toxicity Quotient"</span>)</pre></body></html></div>
<p><img src="benchmarks_files/figure-html/plotBenchChems-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_tox_stacks.html">plot_tox_stacks</a></span>(<span class="no">summary_bench</span>,
                <span class="kw">chem_site</span> <span class="kw">=</span> <span class="no">tox_list_bench</span>$<span class="no">chem_site</span>,
                <span class="kw">category</span> <span class="kw">=</span> <span class="st">"Chemical"</span>,
                <span class="kw">sum_logic</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                <span class="kw">y_label</span> <span class="kw">=</span> <span class="st">"Toxicity Quotient"</span>,
                <span class="kw">include_legend</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="benchmarks_files/figure-html/plotBenchmarksStack-1.png" width="700"></p>
<p>The <code>category</code> argument can be set to “Biological”, and which then shows the distributions of the acute and chronic groupings.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_tox_endpoints.html">plot_tox_endpoints</a></span>(<span class="no">summary_bench</span>,
                   <span class="kw">category</span> <span class="kw">=</span> <span class="st">"Biological"</span>,
                   <span class="kw">x_label</span> <span class="kw">=</span> <span class="st">"Toxicity Quotient"</span>)</pre></body></html></div>
<p><img src="benchmarks_files/figure-html/otherPlot-1.png" width="700"></p>
</div>
<div id="compare-with-toxcast" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-with-toxcast" class="anchor"></a>Compare with ToxCast</h2>
<p>Let’s get the ToxCast example chemical summary as described in the <a href="basicWorkflow.html">Basic Workflow</a>:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">path_to_file</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,
                                      <span class="kw">package</span><span class="kw">=</span><span class="st">"toxEval"</span>),
                          <span class="st">"OWC_data_fromSup.xlsx"</span>)
<span class="no">tox_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_toxEval.html">create_toxEval</a></span>(<span class="no">path_to_file</span>)
<span class="no">ACC</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_ACC.html">get_ACC</a></span>(<span class="no">tox_list</span>$<span class="no">chem_info</span>$<span class="no">CAS</span>)
<span class="no">ACC</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/remove_flags.html">remove_flags</a></span>(<span class="kw">ACC</span> <span class="kw">=</span> <span class="no">ACC</span>)

<span class="no">cleaned_ep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/clean_endPoint_info.html">clean_endPoint_info</a></span>(<span class="no">end_point_info</span>)
<span class="no">filtered_ep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/filter_groups.html">filter_groups</a></span>(<span class="no">cleaned_ep</span>)


<span class="no">summary_tox</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_chemical_summary.html">get_chemical_summary</a></span>(<span class="no">tox_list</span>,
                                    <span class="no">ACC</span>,
                                    <span class="no">filtered_ep</span>)</pre></body></html></div>
<p>We can use the <code>side_by_side_data</code> function to create a single data frame that the <code>toxEval</code> plotting functions can use.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">gd_tox</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/graph_data_prep.html">graph_chem_data</a></span>(<span class="no">summary_tox</span>)
<span class="no">gd_bench</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/graph_data_prep.html">graph_chem_data</a></span>(<span class="no">summary_bench</span>,
                            <span class="kw">sum_logic</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">combo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/graph_data_prep.html">side_by_side_data</a></span>(<span class="no">gd_tox</span>, <span class="no">gd_bench</span>,
                           <span class="kw">left_title</span> <span class="kw">=</span> <span class="st">"ToxCast"</span>,
                           <span class="kw">right_title</span> <span class="kw">=</span> <span class="st">"WQ Benchmarks"</span>)</pre></body></html></div>
<p>The “combo” data frame has a new column “guide_side”, and is a factor containing the “left_title” and “right_title”. This will allow us to facet the output of the chemical boxplots. The ordering of the chemicals is primarily based on the “left” input (so in this case, the ToxCast EARs).</p>
<p>The output of all the <code>toxEval</code> graphs are <code>ggplot2</code> objects. What this means is you can continue to customize the object using <code>ggplot2</code> functions. In this case, we can use <code>facet_grid</code> to separage the data by the column “guide_side”. The name of the facet column must be include without quotes, as shown here:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_tox_boxplots.html">plot_chemical_boxplots</a></span>(<span class="no">combo</span>, <span class="no">guide_side</span>,
                       <span class="kw">x_label</span> <span class="kw">=</span> <span class="st">""</span>) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="no">.</span> ~ <span class="no">guide_side</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_x"</span>)</pre></body></html></div>
<p><img src="benchmarks_files/figure-html/sideBySidePlot-1.png" width="700"></p>
</div>
<div id="compare-with-concentration" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-with-concentration" class="anchor"></a>Compare with Concentration</h2>
<p>We can create a summary data frame that has concentrations instead of EARs as well. We’ve included a function <code>get_concentration_summary</code> to make the chemical_summary data frame input directly from the tox_list.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">summary_conc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_concentration_summary.html">get_concentration_summary</a></span>(<span class="no">tox_list</span>)
<span class="no">gd_conc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/graph_data_prep.html">graph_chem_data</a></span>(<span class="no">summary_conc</span>)

<span class="no">combo2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/graph_data_prep.html">side_by_side_data</a></span>(<span class="no">gd_conc</span>, <span class="no">gd_bench</span>,
                           <span class="kw">left_title</span> <span class="kw">=</span> <span class="st">"Concentration"</span>,
                           <span class="kw">right_title</span> <span class="kw">=</span> <span class="st">"WQ Benchmarks"</span>)

<span class="fu"><a href="../reference/plot_tox_boxplots.html">plot_chemical_boxplots</a></span>(<span class="no">combo2</span>, <span class="no">guide_side</span>,
                       <span class="kw">x_label</span> <span class="kw">=</span> <span class="st">""</span>) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="no">.</span> ~ <span class="no">guide_side</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_x"</span>)</pre></body></html></div>
<p><img src="benchmarks_files/figure-html/concCompare-1.png" width="700"></p>
</div>
<div id="concentrations-benchmarks-and-toxcast" class="section level2">
<h2 class="hasAnchor">
<a href="#concentrations-benchmarks-and-toxcast" class="anchor"></a>Concentrations, benchmarks, and ToxCast</h2>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">combo_all_3</span> <span class="kw">&lt;-</span> <span class="no">combo2</span> <span class="kw">%&gt;%</span>
  <span class="fu">bind_rows</span>(<span class="no">combo</span> <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">guide_side</span> <span class="kw">==</span> <span class="st">"ToxCast"</span>)
            )

<span class="no">combo_all_3</span>$<span class="no">Class</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">combo_all_3</span>$<span class="no">Class</span>,
                       <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">combo2</span>$<span class="no">Class</span>))
<span class="no">combo_all_3</span>$<span class="no">chnm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">combo_all_3</span>$<span class="no">chnm</span>,
                       <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">combo2</span>$<span class="no">chnm</span>))
<span class="no">combo_all_3</span>$<span class="no">guide_side</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">combo_all_3</span>$<span class="no">guide_side</span>,
                       <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Concentration"</span>,
                                  <span class="st">"WQ Benchmarks"</span>,
                                  <span class="st">"ToxCast"</span>))

<span class="fu"><a href="../reference/plot_tox_boxplots.html">plot_chemical_boxplots</a></span>(<span class="no">combo_all_3</span>, <span class="no">guide_side</span>,
                       <span class="kw">x_label</span> <span class="kw">=</span> <span class="st">""</span>) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="no">.</span> ~ <span class="no">guide_side</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_x"</span>)</pre></body></html></div>
<p><img src="benchmarks_files/figure-html/allThree-1.png" width="700"></p>
</div>
</div>
<div id="setupExample" class="section level1">
<h1 class="hasAnchor">
<a href="#setupExample" class="anchor"></a>Create Example File</h1>
<p>This section describes how to use the “benchmarks” option to create a custom analysis.</p>
<p>The example data provided in <code>toxEval</code> is taken from the supplemental information in Baldwin, et al <a href="https://doi.org/10.1016/j.scitotenv.2016.02.137">2016</a>. The third supplemental table provides water quality guideline benchmarks. We’ll provide that table here in a more user-friendly format, with associated CAS values.</p>
<div id="create-custom-benchmark-file" class="section level2">
<h2 class="hasAnchor">
<a href="#create-custom-benchmark-file" class="anchor"></a>Create custom benchmark file</h2>
<p>You can make your own benchmark Microsoft ™ Excel file for the example data provided in the package. The benchmark data come from tab 3 of the supplemental table file in Baldwin, et al <a href="https://doi.org/10.1016/j.scitotenv.2016.02.137">2016</a>. It has been cleaned up to simple text to be copy/pasted into a csv file (the information between the single quotes), or run as R code as follows:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">raw_benchmarks</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw">text</span><span class="kw">=</span><span class="st">[2746 chars quoted with ''']</span>,
<span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>Looking at the “source” column, there are 4 distinct values: EPA_acute, EPA_chronic, other_acute, other_chronic. We have a few choices, we can keep each of those as an “endPoint”, or make the choices only acute/chronic, or even have the endPoints be EPA/other with acute/chronic groupings. In this example, we’ll show how to use this data to make a water quality benchmark analysis just based on the acute/chronic distinction. The “value” in the data above is already in <span class="math inline">\(\mu\)</span>g/L, which matches up with our data. If the units were not aligned, the workflow would need to include converting the benchmark units to match whatever the data is reported in.</p>
<p>Essentially, the work that must be done is to rename some columns, and figure out how to classify the benchmarks. The following code uses the <code>dplyr</code> and <code>tidyr</code> packages for this:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)

<span class="no">bench</span> <span class="kw">&lt;-</span> <span class="no">raw_benchmarks</span> <span class="kw">%&gt;%</span>
  <span class="fu">rename</span>(<span class="kw">Value</span> <span class="kw">=</span> <span class="no">value</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span>(<span class="no">source</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"groupCol"</span>, <span class="st">"endPoint"</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"_"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="fu">select</span>(<span class="no">tox_chemicals</span>,
                   <span class="kw">CAS</span> <span class="kw">=</span> <span class="no">Substance_CASRN</span>,
                   <span class="kw">Chemical</span> <span class="kw">=</span> <span class="no">Substance_Name</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">"CAS"</span>)

<span class="no">bench</span>$<span class="no">Chemical</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">bench</span>$<span class="no">Chemical</span>)] <span class="kw">&lt;-</span> <span class="no">bench</span>$<span class="no">chm_nm</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">bench</span>$<span class="no">Chemical</span>)]

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">bench</span>)</pre></body></html></div>
<pre><code>##        CAS         chm_nm groupCol endPoint  Value       Chemical
## 1 120-12-7     Anthracene      EPA    acute  86.10     Anthracene
## 2  50-32-8 Benzo(a)pyrene      EPA    acute   3.98 Benzo(a)pyrene
## 3 206-44-0   Fluoranthene      EPA    acute  29.60   Fluoranthene
## 4  91-20-3    Naphthalene      EPA    acute 803.00    Naphthalene
## 5  85-01-8   Phenanthrene      EPA    acute  79.70   Phenanthrene
## 6 129-00-0         Pyrene      EPA    acute  42.00         Pyrene</code></pre>
<p>Now we need to get that information into a “tox_list”. Here is how to create the Microsoft ™ Excel file using the <code>openxlsx</code> package:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">path_to_file</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,
                                      <span class="kw">package</span><span class="kw">=</span><span class="st">"toxEval"</span>),
                          <span class="st">"OWC_data_fromSup.xlsx"</span>)
<span class="no">tox_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_toxEval.html">create_toxEval</a></span>(<span class="no">path_to_file</span>)

<span class="no">tox_list_wq_bench</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">Data</span> <span class="kw">=</span> <span class="no">tox_list</span>$<span class="no">chem_data</span>,
                          <span class="kw">Chemicals</span> <span class="kw">=</span> <span class="no">tox_list</span>$<span class="no">chem_info</span>,
                          <span class="kw">Sites</span> <span class="kw">=</span> <span class="no">tox_list</span>$<span class="no">chem_site</span>,
                          <span class="kw">Benchmarks</span> <span class="kw">=</span> <span class="no">bench</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">openxlsx</span>)

<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/write.xlsx.html">write.xlsx</a></span>(<span class="no">tox_list_wq_bench</span>,
           <span class="kw">file</span> <span class="kw">=</span> <span class="st">"OWC_custom_bench.xlsx"</span>)</pre></body></html></div>
<p>Now, we can use this new benchmark tox_list to generate our custom benchmark figures and tables.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">tox_list_bench</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_toxEval.html">create_toxEval</a></span>(<span class="st">"OWC_custom_bench.xlsx"</span>)</pre></body></html></div>
</div>
</div>
<div id="exporting-toxcast-benchmarks" class="section level1">
<h1 class="hasAnchor">
<a href="#exporting-toxcast-benchmarks" class="anchor"></a>Exporting ToxCast Benchmarks</h1>
<p>It is also possible to export the equivalent “Benchmark” data from the ToxCast analysis. Within the Shiny app, there is a button labeled “Download Benchmarks”. If you are navigating the app and find a set of conditions that make sense for your analysis, it is probably a good idea to create a record of the ToxCast ACC values.</p>
<p>Let’s use the data provided in the package to show an example of how to do this directly in R:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">toxEval</span>)

<span class="no">path_to_file</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"toxEval"</span>),
                          <span class="st">"OWC_data_fromSup.xlsx"</span>)
<span class="no">tox_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_toxEval.html">create_toxEval</a></span>(<span class="no">path_to_file</span>)
<span class="no">ACC</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_ACC.html">get_ACC</a></span>(<span class="no">tox_list</span>$<span class="no">chem_info</span>$<span class="no">CAS</span>)
<span class="no">ACC</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/remove_flags.html">remove_flags</a></span>(<span class="kw">ACC</span> <span class="kw">=</span> <span class="no">ACC</span>)

<span class="no">cleaned_ep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/clean_endPoint_info.html">clean_endPoint_info</a></span>(<span class="no">end_point_info</span>)
<span class="no">filtered_ep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/filter_groups.html">filter_groups</a></span>(<span class="no">cleaned_ep</span>)

<span class="no">benchmarks</span> <span class="kw">&lt;-</span> <span class="no">ACC</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">endPoint</span> <span class="kw">%in%</span> <span class="no">filtered_ep</span>$<span class="no">endPoint</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">Value</span> <span class="kw">=</span> <span class="no">ACC_value</span>,
         <span class="kw">Chemical</span> <span class="kw">=</span> <span class="no">chnm</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(<span class="no">filtered_ep</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"endPoint"</span>)

<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html">names</a></span>(<span class="no">benchmarks</span>)</pre></body></html></div>
<pre><code>## [1] "CAS"        "flags"      "endPoint"   "ACC"        "MlWt"      
## [6] "Value"      "Chemical"   "groupCol"   "assaysFull"</code></pre>
<p>The “benchmarks” data frame includes all the information you would need to reproduce the <code>toxEval</code> analysis in the future. This can be important if the ToxCast database is updated, yet you want to reproduce your original results.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Laura DeCicco, Steven Corsi, Daniel Villeneuve, Brett Blackwell, Gerald Ankley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
